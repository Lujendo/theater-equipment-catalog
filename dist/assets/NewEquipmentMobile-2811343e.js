import{u as I,b as K,r as l,c as u,e as R,j as e,B as p,k as H,l as j,g as Q,h as V,f as $,d as O,i as P}from"./index-e9f99a1f.js";import"./pdf-excel-b0340315.js";const J=()=>{var k,S,q,C,_,L;const f=I();K();const[t,v]=l.useState(1),[r,x]=l.useState({type_id:"",category_id:"",brand:"",model:"",serial_number:"",location_id:"",location:"",status:"available",quantity:1,description:"",reference_image_id:""}),[M,U]=l.useState([]),[y,h]=l.useState(""),[E,B]=l.useState(!1),[T,b]=l.useState(!1),{data:i}=u({queryKey:["equipment-types"],queryFn:Q,staleTime:3e5}),{data:o}=u({queryKey:["locations"],queryFn:V,staleTime:3e5});u({queryKey:["categories"],queryFn:$,staleTime:3e5});const{data:d}=u({queryKey:["default-storage-locations"],queryFn:async()=>(await O.get("/api/default-storage-locations")).data,staleTime:3e5});l.useEffect(()=>{var s;if(((s=d==null?void 0:d.defaultStorageLocations)==null?void 0:s.length)>0&&!r.location_id){const a=d.defaultStorageLocations[0];x(c=>{var m;return{...c,location_id:a.location_id.toString(),location:((m=a.location)==null?void 0:m.name)||a.name||"Default Storage",status:"available"}})}},[d,r.location_id]);const g=R({mutationFn:P,onSuccess:s=>{B(!0),j.success("Equipment created successfully!",{icon:"ðŸ“±âœ…"}),setTimeout(()=>{f(`/equipment/${s.equipment.id}`)},1500)},onError:s=>{var a,c;console.error("Error creating equipment:",s),h(((c=(a=s.response)==null?void 0:a.data)==null?void 0:c.message)||"Failed to create equipment"),j.error("Failed to create equipment")}}),n=s=>{const{name:a,value:c}=s.target;x(m=>({...m,[a]:c}))},F=s=>{x(a=>({...a,serial_number:s})),b(!1),j.success("Barcode scanned successfully!",{icon:"ðŸ“±ðŸ“·"}),t===2&&setTimeout(()=>w(),1e3)},N=s=>{if(s.preventDefault(),!r.type_id||!r.brand||!r.model||!r.serial_number){h("Type, brand, model, and serial number are required");return}g.mutate({equipment:r,files:M,referenceImageFile:null,allocation:null})},z=()=>{f("/equipment")},w=()=>{t<4&&v(t+1)},W=()=>{t>1&&v(t-1)},A=["available","in-use","maintenance","unavailable","broken"];return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:z,className:"p-2 text-gray-600 hover:text-gray-800",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Add Equipment"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("span",{children:["Step ",t," of 4"]}),e.jsxs("span",{children:[Math.round(t/4*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${t/4*100}%`}})})]})]})}),y&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-red-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-red-700",children:y}),e.jsx("button",{onClick:()=>h(""),className:"ml-auto text-red-400 hover:text-red-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),E&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-green-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-green-700",children:"Equipment created! Redirecting..."})]})}),e.jsxs("form",{onSubmit:N,className:"px-4 py-4",children:[t===1&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Equipment Type *"}),e.jsxs("select",{name:"type_id",value:r.type_id,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),(k=i==null?void 0:i.types)==null?void 0:k.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand *"}),e.jsx("input",{type:"text",name:"brand",value:r.brand,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter brand",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model *"}),e.jsx("input",{type:"text",name:"model",value:r.model,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter model",required:!0})]})]})}),t===2&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Serial Number"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Serial Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"serial_number",value:r.serial_number,onChange:n,className:"w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter or scan serial number",required:!0}),e.jsx("button",{type:"button",onClick:()=>b(!0),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Tap the scan icon to use your camera"})]})]})}),t===3&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Location & Status"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),e.jsxs("select",{name:"location_id",value:r.location_id,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Location"}),(S=o==null?void 0:o.locations)==null?void 0:S.map(s=>e.jsxs("option",{value:s.id,children:[s.name,s.city&&` (${s.city})`]},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{name:"status",value:r.status,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:A.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1).replace("-"," ")},s))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),e.jsx("input",{type:"number",name:"quantity",min:"1",value:r.quantity,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]})}),t===4&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Description & Review"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",value:r.description,onChange:n,rows:"3",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter description (optional)"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"Review"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",((C=(q=i==null?void 0:i.types)==null?void 0:q.find(s=>s.id.toString()===r.type_id))==null?void 0:C.name)||"Not selected"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Brand:"})," ",r.brand||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Model:"})," ",r.model||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Serial:"})," ",r.serial_number||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Location:"})," ",((L=(_=o==null?void 0:o.locations)==null?void 0:_.find(s=>s.id.toString()===r.location_id))==null?void 0:L.name)||"Default Storage"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Quantity:"})," ",r.quantity]})]})]})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:W,disabled:t===1,className:"flex-1 mr-2",children:"Previous"}),t<4?e.jsx(p,{type:"button",variant:"primary",onClick:w,className:"flex-1 ml-2",children:"Next"}):e.jsx(p,{type:"submit",variant:"primary",onClick:N,disabled:g.isLoading,className:"flex-1 ml-2",children:g.isLoading?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):"Create Equipment"})]})}),T&&e.jsx(H,{onScan:F,onClose:()=>b(!1)})]})};export{J as default};
//# sourceMappingURL=NewEquipmentMobile-2811343e.js.map
